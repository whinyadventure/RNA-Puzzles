{% extends  'base.html' %}
{% block head %}
  {{ form.media }}
{% endblock %}


{% block content %}
  {% load crispy_forms_tags %}
<form method="post">
   {% csrf_token %}
  {{ form| crispy }}
    <button type="submit" class="btn btn-primary">Sign in</button>
</form>
{% endblock %}

gcloud beta data proc clusters create project-1 --enable-component-gateway--bucket pbd-pr1  -region europe-west3 --subnet default --zone europe-west3-c --master-machine-type n1-standard-2 --master-boot-disk-size 50 --num-workers 2 --worker-machine-type n1-standard-2 --worker-boot-disk-size 50 --image-version 1.3-deb9 --optional-components ANACONDA,JUPYTER,ZEPPELIN --project pbd-project-1 --max-age=2h

DROP TABLE BASIC;
CREATE TABLE BASIC(
tconst STRING,
titleType STRING,
primaryTitle String,
originalTitle String,
isAdult Boolean,
startYear Int,
endYear Int,
runtimeMinutes Int,
genres String) ROW FORMAT DELIMITED
FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;
LOAD DATA INPATH "inputs/title.basics.tsv" INTO TABLE BASIC;
Select * From Basic LIMIT 10;

DROP TABLE MapReduce;
CREATE TABLE MapReduce(
tconst STRING,
count INT)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '\t'
STORED AS TEXTFILE;
LOAD DATA INPATH "output/" INTO Table MapReduce;
Select * From MapReduce Limit 10;
Select to_json(named_struct('tconst', tconst, "count", count)) FROM MapReduce;

Select genre, Count(*), Sum(count) FROM MapReduce mr JOIN (Select tconst, genre From Basic LATERAL VIEW explode(split(genres,",")) genres as genre Where titleType="movie") as ba  ON (mr.tconst = ba.tconst) Group By genre Order BY COUNT(count);
